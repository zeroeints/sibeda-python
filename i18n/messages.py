from __future__ import annotations
from typing import Dict

# Katalog pesan multibahasa.
# Key konvensi snake_case.
# Tambah bahasa baru dengan menambahkan kunci top-level (misal 'jp').
_MESSAGES: Dict[str, Dict[str, str]] = {
    "id": {
        "login_success": "Login berhasil",
        "logout_success": "Logout berhasil",
        "token_refresh_success": "Token berhasil diperbarui",
        "password_change_success": "Password berhasil diubah",
        "old_password_incorrect": "Password lama tidak benar",
        "new_password_same_as_old": "Password baru tidak boleh sama dengan password lama",
        "invalid_credentials": "NIP atau password salah",
        "not_authenticated": "Tidak terautentikasi",
        "permission_denied": "Tidak punya akses",
        "validation_error": "Data tidak valid",
        "internal_error": "Terjadi kesalahan pada server",
        "user_create_success": "User berhasil dibuat",
        "vehicle_create_success": "Kendaraan berhasil dibuat",
        "vehicle_delete_success": "Kendaraan berhasil dihapus",
        "wallet_delete_success": "Wallet berhasil dihapus",
        "report_create_success": "Laporan berhasil dibuat",
        "report_update_success": "Laporan berhasil diperbarui",
        "report_delete_success": "Laporan berhasil dihapus",
        "vehicle_type_create_success": "Tipe kendaraan berhasil dibuat",
        "vehicle_type_update_success": "Tipe kendaraan berhasil diperbarui",
        "vehicle_type_delete_success": "Tipe kendaraan berhasil dihapus",
        "otp_sent": "Kode OTP telah dikirim",
        "otp_invalid": "Kode OTP tidak valid",
        "otp_expired": "Kode OTP kedaluwarsa",
        "password_reset_success": "Password berhasil direset",
        "create_success": "Data berhasil dibuat",
        "update_success": "Data berhasil diperbarui",
        "delete_success": "Data berhasil dihapus",
        "not_found": "Data tidak ditemukan",
        "duplicate_entry": "Data sudah terdaftar",
        # QR flows
        "qr_ready": "Kode QR siap digunakan",
        "user_already_has_dinas": "Pengguna sudah memiliki Dinas",
        "user_not_found": "Pengguna tidak ditemukan",
        "dinas_not_found": "Dinas tidak ditemukan",
        "qr_invalid": "Kode QR tidak valid",
        "qr_expired": "Kode QR kedaluwarsa",
        "dinas_assigned": "Dinas berhasil ditetapkan",
    },
    "en": {
        "login_success": "Login successful",
        "logout_success": "Logout successful",
        "token_refresh_success": "Token refreshed successfully",
        "password_change_success": "Password changed successfully",
        "old_password_incorrect": "Old password is incorrect",
        "new_password_same_as_old": "New password cannot be the same as old password",
        "invalid_credentials": "Invalid NIP or password",
        "not_authenticated": "Not authenticated",
        "permission_denied": "Permission denied",
        "validation_error": "Validation error",
        "internal_error": "Internal server error",
        "user_create_success": "User created successfully",
        "vehicle_create_success": "Vehicle created successfully",
        "vehicle_delete_success": "Vehicle deleted successfully",
        "wallet_delete_success": "Wallet deleted successfully",
        "report_create_success": "Report created successfully",
        "report_update_success": "Report updated successfully",
        "report_delete_success": "Report deleted successfully",
        "vehicle_type_create_success": "Vehicle type created successfully",
        "vehicle_type_update_success": "Vehicle type updated successfully",
        "vehicle_type_delete_success": "Vehicle type deleted successfully",
        "otp_sent": "OTP code has been sent",
        "otp_invalid": "Invalid OTP code",
        "otp_expired": "OTP code expired",
        "password_reset_success": "Password reset successfully",
        "create_success": "Created successfully",
        "update_success": "Updated successfully",
        "delete_success": "Deleted successfully",
        "not_found": "Data not found",
        "duplicate_entry": "Duplicate entry",
        # QR flows
        "qr_ready": "QR code is ready",
        "user_already_has_dinas": "User already has a Dinas",
        "user_not_found": "User not found",
        "dinas_not_found": "Dinas not found",
        "qr_invalid": "Invalid QR code",
        "qr_expired": "QR code expired",
        "dinas_assigned": "Dinas assigned successfully",
    },
    "ja": {
        "login_success": "ログイン成功",
        "logout_success": "ログアウト成功",
        "token_refresh_success": "トークン更新成功",
        "password_change_success": "パスワード変更成功",
        "old_password_incorrect": "旧パスワードが正しくありません",
        "new_password_same_as_old": "新しいパスワードは旧パスワードと同じにできません",
        "invalid_credentials": "NIP またはパスワードが正しくありません",
        "not_authenticated": "認証されていません",
        "permission_denied": "アクセス権がありません",
        "validation_error": "検証エラー",
        "internal_error": "サーバー内部エラー",
        "user_create_success": "ユーザーを作成しました",
        "vehicle_create_success": "車両を作成しました",
        "vehicle_delete_success": "車両を削除しました",
        "wallet_delete_success": "ウォレットを削除しました",
        "report_create_success": "レポートを作成しました",
        "report_update_success": "レポートを更新しました",
        "report_delete_success": "レポートを削除しました",
        "vehicle_type_create_success": "車両タイプを作成しました",
        "vehicle_type_update_success": "車両タイプを更新しました",
        "vehicle_type_delete_success": "車両タイプを削除しました",
        "otp_sent": "OTPコードを送信しました",
        "otp_invalid": "無効なOTPコードです",
        "otp_expired": "OTPコードの有効期限が切れています",
        "password_reset_success": "パスワードをリセットしました",
        "create_success": "作成に成功しました",
        "update_success": "更新に成功しました",
        "delete_success": "削除に成功しました",
        "not_found": "データが見つかりません",
        "duplicate_entry": "重複したデータです",
        # QR flows
        "qr_ready": "QRコードの準備ができました",
        "user_already_has_dinas": "ユーザーはすでにDinasが設定されています",
        "user_not_found": "ユーザーが見つかりません",
        "dinas_not_found": "Dinasが見つかりません",
        "qr_invalid": "無効なQRコードです",
        "qr_expired": "QRコードの有効期限が切れています",
        "dinas_assigned": "Dinasが割り当てられました",
    },
    "zh": {
        "login_success": "登录成功",
        "logout_success": "登出成功",
        "token_refresh_success": "令牌刷新成功",
        "password_change_success": "密码修改成功",
        "old_password_incorrect": "旧密码不正确",
        "new_password_same_as_old": "新密码不能与旧密码相同",
        "invalid_credentials": "NIP或密码错误",
        "not_authenticated": "未认证",
        "permission_denied": "没有访问权限",
        "validation_error": "验证错误",
        "internal_error": "服务器内部错误",
        "user_create_success": "用户创建成功",
        "vehicle_create_success": "车辆创建成功",
        "vehicle_delete_success": "车辆删除成功",
        "wallet_delete_success": "钱包删除成功",
        "report_create_success": "报告创建成功",
        "report_update_success": "报告更新成功",
        "report_delete_success": "报告删除成功",
        "vehicle_type_create_success": "车辆类型创建成功",
        "vehicle_type_update_success": "车辆类型更新成功",
        "vehicle_type_delete_success": "车辆类型删除成功",
        "otp_sent": "OTP验证码已发送",
        "otp_invalid": "OTP验证码无效",
        "otp_expired": "OTP验证码已过期",
        "password_reset_success": "密码重置成功",
        "create_success": "创建成功",
        "update_success": "更新成功",
        "delete_success": "删除成功",
        "not_found": "数据未找到",
        "duplicate_entry": "数据已存在",
        # QR flows
        "qr_ready": "二维码已就绪",
        "user_already_has_dinas": "用户已拥有 Dinas",
        "user_not_found": "未找到用户",
        "dinas_not_found": "未找到 Dinas",
        "qr_invalid": "无效的二维码",
        "qr_expired": "二维码已过期",
        "dinas_assigned": "Dinas 分配成功",
    },
    "fr": {
        "login_success": "Connexion réussie",
        "logout_success": "Déconnexion réussie",
        "token_refresh_success": "Jeton actualisé avec succès",
        "password_change_success": "Mot de passe modifié avec succès",
        "old_password_incorrect": "L'ancien mot de passe est incorrect",
        "new_password_same_as_old": "Le nouveau mot de passe ne peut pas être identique à l'ancien",
        "invalid_credentials": "NIP ou mot de passe incorrect",
        "not_authenticated": "Non authentifié",
        "permission_denied": "Accès refusé",
        "validation_error": "Erreur de validation",
        "internal_error": "Erreur interne du serveur",
        "user_create_success": "Utilisateur créé avec succès",
        "vehicle_create_success": "Véhicule créé avec succès",
        "vehicle_delete_success": "Véhicule supprimé avec succès",
        "wallet_delete_success": "Portefeuille supprimé avec succès",
        "report_create_success": "Rapport créé avec succès",
        "report_update_success": "Rapport mis à jour avec succès",
        "report_delete_success": "Rapport supprimé avec succès",
        "vehicle_type_create_success": "Type de véhicule créé avec succès",
        "vehicle_type_update_success": "Type de véhicule mis à jour avec succès",
        "vehicle_type_delete_success": "Type de véhicule supprimé avec succès",
        "otp_sent": "Code OTP envoyé",
        "otp_invalid": "Code OTP invalide",
        "otp_expired": "Code OTP expiré",
        "password_reset_success": "Mot de passe réinitialisé avec succès",
        "create_success": "Créé avec succès",
        "update_success": "Mis à jour avec succès",
        "delete_success": "Supprimé avec succès",
        "not_found": "Données introuvables",
        "duplicate_entry": "Entrée en double",
        # QR flows
        "qr_ready": "Le code QR est prêt",
        "user_already_has_dinas": "L'utilisateur a déjà un Dinas",
        "user_not_found": "Utilisateur introuvable",
        "dinas_not_found": "Dinas introuvable",
        "qr_invalid": "Code QR invalide",
        "qr_expired": "Code QR expiré",
        "dinas_assigned": "Dinas attribué avec succès",
    },
    "ko": {
        "login_success": "로그인 성공",
        "logout_success": "로그아웃 성공",
        "token_refresh_success": "토큰 갱신 성공",
        "password_change_success": "비밀번호 변경 성공",
        "old_password_incorrect": "이전 비밀번호가 올바르지 않습니다",
        "new_password_same_as_old": "새 비밀번호는 이전 비밀번호와 같을 수 없습니다",
        "invalid_credentials": "NIP 또는 비밀번호가 올바르지 않습니다",
        "not_authenticated": "인증되지 않았습니다",
        "permission_denied": "접근 권한이 없습니다",
        "validation_error": "검증 오류",
        "internal_error": "서버 내부 오류",
        "user_create_success": "사용자가 성공적으로 생성되었습니다",
        "vehicle_create_success": "차량이 성공적으로 생성되었습니다",
        "vehicle_delete_success": "차량이 성공적으로 삭제되었습니다",
        "wallet_delete_success": "지갑이 성공적으로 삭제되었습니다",
        "report_create_success": "보고서가 성공적으로 생성되었습니다",
        "report_update_success": "보고서가 성공적으로 업데이트되었습니다",
        "report_delete_success": "보고서가 성공적으로 삭제되었습니다",
        "vehicle_type_create_success": "차량 유형이 성공적으로 생성되었습니다",
        "vehicle_type_update_success": "차량 유형이 성공적으로 업데이트되었습니다",
        "vehicle_type_delete_success": "차량 유형이 성공적으로 삭제되었습니다",
        "otp_sent": "OTP 코드가 전송되었습니다",
        "otp_invalid": "잘못된 OTP 코드입니다",
        "otp_expired": "OTP 코드가 만료되었습니다",
        "password_reset_success": "비밀번호가 성공적으로 재설정되었습니다",
        "create_success": "성공적으로 생성되었습니다",
        "update_success": "성공적으로 업데이트되었습니다",
        "delete_success": "성공적으로 삭제되었습니다",
        "not_found": "데이터를 찾을 수 없습니다",
        "duplicate_entry": "중복된 데이터",
        # QR flows
        "qr_ready": "QR 코드가 준비되었습니다",
        "user_already_has_dinas": "사용자는 이미 Dinas가 있습니다",
        "user_not_found": "사용자를 찾을 수 없습니다",
        "dinas_not_found": "Dinas를 찾을 수 없습니다",
        "qr_invalid": "유효하지 않은 QR 코드입니다",
        "qr_expired": "QR 코드가 만료되었습니다",
        "dinas_assigned": "Dinas가 성공적으로 할당되었습니다",
    },
}

DEFAULT_LANG = "id"


def normalize_lang(lang: str | None) -> str:
    if not lang:
        return DEFAULT_LANG
    lang = lang.lower()
    if lang not in _MESSAGES:
        return DEFAULT_LANG
    return lang


def get_message(key: str, lang: str | None = None) -> str:
    lang_code = normalize_lang(lang)
    # fallback ke default bila key tidak ditemukan di bahasa yg dipilih
    return _MESSAGES.get(lang_code, {}).get(key, _MESSAGES[DEFAULT_LANG].get(key, key))


def available_languages() -> list[str]:
    return list(_MESSAGES.keys())


def is_supported_lang(lang: str | None) -> bool:
    if not lang:
        return False
    return lang.lower() in _MESSAGES
